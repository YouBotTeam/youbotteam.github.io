var form,mainContainer,chatContainer,containerCustom,autocompleteElement,customPopupClassList,conversationContainer,webchat=window.WebChat,token="",inputChat="",lastSearch="",showPopup=!0,storageType="",project_id=null,typingTimer=null,configuration={},listOfFileSelected=[],commanderResponse=null;const styleOfDocument=document.documentElement.style,fullScreenOpen="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBmaWxsPSJ3aGl0ZSIgZD0iTTY0IDM3MS4yaDc2Ljc5NVY0NDhIMTkyVjMyMEg2NHY1MS4yem03Ni43OTUtMjMwLjRINjRWMTkyaDEyOFY2NGgtNTEuMjA1djc2Ljh6TTMyMCA0NDhoNTEuMnYtNzYuOEg0NDhWMzIwSDMyMHYxMjh6bTUxLjItMzA3LjJWNjRIMzIwdjEyOGgxMjh2LTUxLjJoLTc2Ljh6Ii8+PC9zdmc+",fullScreenClose="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBmaWxsPSJ3aGl0ZSIgZD0iTTM5Ni43OTUgMzk2LjhIMzIwVjQ0OGgxMjhWMzIwaC01MS4yMDV6TTM5Ni44IDExNS4yMDVWMTkySDQ0OFY2NEgzMjB2NTEuMjA1ek0xMTUuMjA1IDExNS4ySDE5MlY2NEg2NHYxMjhoNTEuMjA1ek0xMTUuMiAzOTYuNzk1VjMyMEg2NHYxMjhoMTI4di01MS4yMDV6Ii8+PC9zdmc+",iconDone=`<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#ffffff"><path d="M0 0h24v24H0z" fill="none"/><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>`,iconError=`<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#ff0000"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"/></svg>`,iconDoubleDone=`<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#ffffff"><path d="M0 0h24v24H0z" fill="none"/><path d="M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z"/></svg>`;function YouaiWebChat(){}YouaiWebChat.configuration=a=>{const{title:b,subtitle:c,inputTextFieldHint:d,profileAvatar:e,customData:f,socketUrl:g,socketPath:h,showFullScreenButton:i,showBadge:j,docViewer:k,hideWhenNotConnected:l,openAutomatically:m,initPayload:n,selector:o,storage:p,elementTriggerResetChat:q,elementTriggerOpenChat:r}=a.webchat;storageType=p,token=a.token,webchat.default({customData:{...f,token:a.token},socketUrl:g,socketPath:h,showBadge:j,selector:o,docViewer:k,initPayload:n,showFullScreenButton:i,hideWhenNotConnected:l,openAutomatically:m,title:b,subtitle:c,inputTextFieldHint:d,profileAvatar:e,elementTriggerOpenChat:r,elementTriggerResetChat:q,params:{storage:p}}),configuration=a.custom,project_id=configuration.project_id||null,getStorage()},document.addEventListener("readystatechange",()=>{"interactive"===document.readyState&&(setCustomStyleOfPage(),configuration.clearCacheOnRefresh&&getStorage().clear(),checkElement("#rasaWebchatPro").then(()=>{const a=new MutationObserver(a=>{const b=a[0].addedNodes;b.length&&(mainContainer=document.getElementsByClassName("rw-widget-container")[0],webChatOperation())}),b=document.getElementById("rasaWebchatPro").children[0];a.observe(b,{childList:!0}),checkElement(".rw-widget-container").then(()=>{const a=new MutationObserver(()=>{webChatOperation()});a.observe(mainContainer,{attributes:!0})})}))});var statusChat=()=>mainContainer.classList.contains("rw-chat-open")?mainContainer.classList.contains("rw-full-screen")?statusWebChat.FULLSCREEN:statusWebChat.OPEN:statusWebChat.CLOSE;function setCustomStyleOfPage(){const a=configuration?.color;if(a){const b=a?.primary,c=a?.message,d=a?.sendButton,e=c?.bot,f=c?.user,g=a?.title?.color;g&&styleOfDocument.setProperty("--youai-color-title",g);const h=a?.subTitle?.color;if(h&&styleOfDocument.setProperty("--youai-color-subtitle",h),b&&styleOfDocument.setProperty("--youai-primary-color",b),f){const a=f?.backgroundColor,b=f?.color;a&&styleOfDocument.setProperty("--youai-msg-user-bg-color",a),b&&styleOfDocument.setProperty("--youai-msg-user-text-color",b)}if(e){const a=e?.backgroundColor,b=e?.color;a&&styleOfDocument.setProperty("--youai-msg-bot-bg-color",a),b&&(styleOfDocument.setProperty("--youai-msg-bot-text-color",b),styleOfDocument.setProperty("--youai-color-wave-dot",b))}d&&styleOfDocument.setProperty("--youai-button-send-color",d)}const b=configuration?.mainButtonDimension;if(b){const a=b?.width,c=b?.height;a&&styleOfDocument.setProperty("--youai-width-button",a),c&&styleOfDocument.setProperty("--youai-height-button",c)}}function createAutocomplete(){if(!document.querySelector(".autocomplete")){const a=document.createElement("div");a.classList.add("autocomplete","youai-container-input");const b=document.getElementsByClassName("rw-new-message")[0];b.setAttribute("id","autocomplete");const c=document.getElementsByClassName("rw-send")[0];if(a.appendChild(b),a.appendChild(c),configuration?.section?.attachments?.show){a.insertAdjacentHTML("afterbegin","\n      <button id=\"youai-btn-attachments\" type=\"button\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 0 24 24\" width=\"24px\" fill=\"#808080\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z\"/></svg>\n      </button>"),handleInputFileModal()}form.setAttribute("autocomplete","off"),form.appendChild(a)}}function handleInputFileModal(){checkElement("#youai-btn-attachments").then(()=>{document.getElementById("youai-btn-attachments").addEventListener("click",()=>{if(!document.querySelector(".youai-modal-attachments")){chatContainer.insertAdjacentHTML("afterbegin",`
            <div class="youai-container-modal-attachments" data-keyboard="false" data-backdrop="static">
              <div class="youai-modal-attachments">
                <div class="youai-input-file-container">
                  ${`<svg xmlns="http://www.w3.org/2000/svg" class="youai-icon-upload" height="24px" viewBox="0 0 24 24" width="24px" fill="#000000"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>`}
                  <input type="file" id="youai-input-file-attachments" accept="${configuration?.section?.attachments?.accept||null}" multiple/>
                  <h2>Scegli un file</h2>
                </div>
                <div class="youai-file-selected-container" style="display: none;">
                </div>
                <div class="youai-btn-footer-attachments">
                  <button id="youai-cancel-attachments" class="rw-conversation-container rw-reply"> Annulla</button>
                  <button id="youai-confirm-attachments" disabled class="rw-conversation-container rw-reply"> Conferma</button>
                </div>
              </div>
            </div>
            `);const a=document.getElementById("youai-cancel-attachments"),b=document.getElementById("youai-confirm-attachments"),c=document.getElementById("youai-input-file-attachments");c.addEventListener("change",a=>{listOfFileSelected=Object.values(a.target.files).map(a=>a),generateUIListFileSelected(b)}),a.addEventListener("click",()=>{removeAttachmentsSection()}),b.addEventListener("click",()=>{const a=new FormData;listOfFileSelected.forEach((b,c)=>a.append(`file##${c}`,b,b.name)),uploadMedia(a).then(a=>{generateMessage(a,!1)},()=>generateMessage(null,!0)),removeAttachmentsSection()})}})})}function generateMessage(a,b){const c=document.getElementsByClassName("rw-group-message rw-from-response"),d=chatContainer.getElementsByClassName("rw-group-message rw-from-response")[c.length-1];d.insertAdjacentHTML("beforeend",`<div class="rw-group-message rw-from-client">
      <div class="rw-message rw-with-avatar">
        <div class="rw-client">
          <div class="rw-message-text">
            ${b?`Errore nell'invio dei file`:`<h1> File caricati: </h1> ${generateListOfNameFileUploaded(a)} `}
          </div>
        </div>
      </div>
    </div>`),chatContainerScrollBottom()}function generateListOfNameFileUploaded(a){return`${null===a?``:`
  <div class="youai-list-file-uploaded">${a.map(a=>`<div class="youai-item-file-uploaded">
          <div id="${a.filename}" class="youai-item-file-uploaded-status">
            ${a.success?iconDoubleDone:iconError}
          </div>
          <div class="youai-item-file-upload-name">
            ${a.filename}
          </div>
        </div>`).toString().replaceAll(",","")}
  </div>`}`}function removeAttachmentsSection(){listOfFileSelected=[],chatContainer.removeChild(chatContainer.getElementsByClassName("youai-container-modal-attachments")[0])}function generateUIListFileSelected(a){const b=document.getElementsByClassName("youai-input-file-container")[0],c=document.getElementsByClassName("youai-file-selected-container")[0];if(listOfFileSelected.length){const e=new FormData;var d="";listOfFileSelected.forEach((a,b)=>{const c=`<svg xmlns="http://www.w3.org/2000/svg" onclick="fileSelezionato('${a.name}##${b}')" class="youai-delete-file" height="24px" viewBox="0 0 24 24" width="24px" fill="#000000"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"/></svg>`;e.append(`file-${b}`,a),d+=`
        <li class="youai-file-selected" id="${a.name}##${b}">
          ${c}
          <p class="youai-name-file">
            ${a.name}
          </p>
        </li>
      `}),c.innerHTML=`
      <ul class="youai-ul youai-ul-file-selected">
        ${d}
      <ul>
    `,a.removeAttribute("disabled"),b.style.display="none",c.style.display=""}else b.style.display="",c.style.display="none"}function fileSelezionato(a){const b=a.split("##");listOfFileSelected=listOfFileSelected.filter(a=>a.name!==b[0]),document.getElementsByClassName("youai-ul-file-selected")[0].removeChild(document.getElementById(a)),generateUIListFileSelected(document.getElementById("youai-confirm-attachments"))}function webChatOperation(){if(mainContainer){const a=document.getElementsByClassName("autocomplete youai-container-input")[0];switch(statusChat()){case statusWebChat.OPEN:form=document.getElementsByClassName("rw-sender")[0],createAutocomplete(),autocomplete();const b=configuration?.section,c=b?.buttonMenu.enable;configuration?.baseUrl&&c&&(b?.pillole?.enable||b?.resetChat?.enable)&&buttonMenuToggle(),conversationContainer=document.getElementsByClassName("rw-conversation-container")[0],chatContainer=conversationContainer.getElementsByClassName("rw-messages-container")[0],document.querySelector(".youai-container-custom")&&removeConversationContainer(),configuration?.enableClickOnImage&&(mutationObserverChatContainer(),clickOnImage());const d=document.getElementsByClassName("rw-new-message")[0];d.addEventListener("input",a=>{inputChat=a.srcElement.value,document.getElementsByClassName("rw-send")[0].addEventListener("click",()=>{inputConversationMthd(a.target.value)})}),customPopupClassList?.add("youai-display-none"),d.addEventListener("keyup",a=>{"Enter"===a.key&&inputChat&&inputConversationMthd(inputChat)}),a&&a.style.removeProperty("height");const e=[...document.getElementsByClassName("rw-header")].filter(a=>!a.classList.contains("custom-header"))[0].getElementsByClassName("rw-toggle-fullscreen-button");e.length&&e[0].addEventListener("click",()=>{mainContainer.classList.toggle("rw-full-screen")}),setSizeOfImage(null,null),setHeightOfIframe(null);break;case statusWebChat.FULLSCREEN:a&&(a.style.height="3rem"),setHeightOfIframe("30rem"),setSizeOfImage("30rem","20rem"),styleOfDocument.setProperty("--youai-rw-widget-container-width","100%");break;case statusWebChat.CLOSE:const f=configuration?.section?.widget;f&&styleOfDocument.setProperty("--youai-rw-widget-container-width",f?.width),localStorage.getItem("interaction")&&configuration?.section?.feedback?.enable&&openFeedbackSection(),localStorage.setItem("position","popup");const g=configuration?.section?.popup;showPopup&&"popup"===localStorage.getItem("position")&&g?.show&&!localStorage.getItem("interaction")&&(createCustomPopup(g?.text||"Clicca sul bottone per inziare la chat"),customPopupClassList.add("youai-fade-in"),customPopupClassList.remove("youai-display-none"),showPopup=!1),localStorage.removeItem("interaction"),localStorage.setItem("position","close");}const b=configuration?.section?.pillole;if(document.querySelector(".rw-toggle-fullscreen-button")&&document.querySelector(".custom-header")&&b?.enableFullScreen&&b?.filename){const a=document.getElementsByClassName("rw-toggle-fullscreen-button"),b=a[0].getElementsByTagName("img")[0],c=a[1].getElementsByTagName("img")[0];setIconToButtonFullScreen(b),setIconToButtonFullScreen(c),b.classList.add("rw-toggle-fullscreen","rw-fullScreenImage"),c.classList.add("rw-toggle-fullscreen","rw-fullScreenExitImage"),c.classList.remove("rw-fullScreenImage")}localStorage.getItem("hint")&&(statusChat()===statusWebChat.FULLSCREEN||statusChat()===statusWebChat.OPEN)&&autocompleteElement?.value&&lastSearch&&commanderResponse&&autocompleteElement.value===lastSearch||createListToComplete(autocompleteElement,commanderResponse)}}function setSizeOfImage(a,b){const c=[...document.getElementsByClassName("rw-image-details")];c.forEach(c=>{const d=c.children[0].style;d.width=a,d.height=b})}function setHeightOfIframe(a){[...document.getElementsByTagName("iframe")].forEach(b=>{b.style.height=a})}function setIconToButtonFullScreen(a){statusChat()===statusWebChat.FULLSCREEN?a.setAttribute("src",fullScreenOpen):a.setAttribute("src",fullScreenClose)}function fullScreenButton(){return configuration?.section?.pillole?.enableFullScreen?`
  <button class="rw-toggle-fullscreen-button" id="customFullScreenButton">
    <img class="rw-toggle-fullscreen rw-fullScreenImage" alt="toggle fullscreen">
  </button>
  `:""}function inputConversationMthd(a){a.trim()&&localStorage.setItem("interaction",!0)}function createCustomPopup(a){document.querySelector(".youai-popup-custom")||(document.getElementsByClassName("rw-widget-container")[0].insertAdjacentHTML("beforeend",`<div class="youai-popup-custom">${a}</div>`),customPopupClassList=document.getElementsByClassName("youai-popup-custom")[0].classList)}function buttonMenuToggle(){if(!document.getElementsByClassName("youai-dropdown").length){const a=configuration?.section,b=a?.resetChat?.enable,c=a?.pillole?.enable;document.getElementsByClassName("rw-header-buttons")[0].insertAdjacentHTML("beforeend",`
        <div class="youai-dropdown">
          <button class="youai-button-menu">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#ffffff" class="bi bi-three-dots-vertical rw-default youai-icon-button-menu" viewBox="0 0 16 16">
              <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
            </svg>
          </button>
          <div id="youai-dropdown-content">
          ${c?`<a
              id="pillole"
              class="${configuration?.section?.pillole?.disableButton?"youai-disabled-link":""}">
                Pillole
              </a>`:``}
            ${b?`<a id="reset-chat">Reset chat</a>`:``}
          </div>
        </div>`),document.getElementsByClassName("youai-button-menu")[0].addEventListener("click",function(a){document.getElementById("youai-dropdown-content").style.display="block",a.stopPropagation()}),c&&document.getElementById("pillole").addEventListener("click",()=>{showOrHideChatContainer(!1),showOrHideHeaderContainer(!1),containerCustom=document.createElement("div"),containerCustom.classList.add("rw-messages-container","youai-container-custom"),pilloleSection()})}}function openFeedbackSection(){createConversationContainer(),containerCustom=document.createElement("div"),containerCustom.classList.add("rw-messages-container","youai-container-custom"),feedbackSection()}function createConversationContainer(){conversationContainer=document.createElement("div"),conversationContainer.classList.add("rw-conversation-container","custom-container"),mainContainer.insertAdjacentElement("afterbegin",conversationContainer)}function mutationObserverChatContainer(){const a=new MutationObserver(()=>{clickOnImage()});a.observe(chatContainer,{childList:!0})}function clickOnImage(){const a=document.querySelectorAll(".rw-image-frame");a.forEach(a=>{"BUTTON"!==a.parentNode.nodeName&&a.addEventListener("click",a=>{window.open(a.srcElement.currentSrc,"_blank")},!1)})}function removeAvatarOnMsg(){const a=document.getElementById("rw-messages"),b=a.getElementsByClassName("rw-from-response");for(var c of b){const a=c.getElementsByClassName("rw-message")[0];a.classList.remove("rw-with-avatar"),a.removeChild(c.getElementsByTagName("img")[0])}}function feedbackSection(){const a=statusChat()===statusWebChat.FULLSCREEN;if(!document.querySelector("#youai-container-custom")){a&&mainContainer.classList.remove("rw-full-screen"),localStorage.setItem("position","feedback"),conversationContainer.appendChild(containerCustom);const b=[,,,,,].fill(`${"\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-star-fill\" viewBox=\"0 0 16 16\">\n      <path d=\"M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z\"/>\n    </svg>"}`);containerCustom.innerHTML=`
      <div id="youai-container-custom">
        <div class="youai-class-rating">
        </div>
        <div class="youai-container-textarea">
            <textarea id="youai-textareabox" placeholder="Lascia un feedback..."></textarea>
        </div>
        <p id="youai-error-feedback"></p>
        <div class="youai-container-button">
          <input type="button" value="Invia" id="youAiSendFeedback" />
        </div>
      </div>`,createCustomHeader(configuration?.section.feedback?.title||"Lascia un feedback");const c=document.getElementsByClassName("youai-class-rating")[0];b.forEach(a=>c.insertAdjacentHTML("afterbegin",a)),handleStarFeedback(),document.getElementById("youAiSendFeedback").addEventListener("click",()=>{let a=document.getElementById("youai-textareabox"),b=a.value.trim();const d=[...c.getElementsByTagName("svg")],e=d.filter(a=>a.classList.contains("youai-checked")).length;submitFeedback(b,e),removeConversationContainer()})}}function handleStarFeedback(){const a=[...document.getElementsByClassName("youai-class-rating")[0].getElementsByTagName("svg")];a.forEach((b,c)=>{let d="";b.addEventListener("mouseover",()=>{"click"!==d&&(d="mouseover",starAddChecked(a.slice(0,c+1)),starRemoveChecked(a.slice(c+1,a.length)))}),b.addEventListener("mouseout",()=>{"click"!==d&&(d="mouseout",starRemoveChecked(a))}),b.addEventListener("click",()=>{d="click",a[c].classList.add("youai-checked")})})}function starRemoveChecked(a){a.forEach(a=>{a.classList.remove("youai-checked")})}function starAddChecked(a){a.forEach(a=>{a.classList.add("youai-checked")})}function pilloleSection(){conversationContainer.querySelector(".container-pillole")||document.querySelector(".youai-container-custom")||(localStorage.setItem("position","pillole"),createCustomHeader("Pillole"),conversationContainer.appendChild(containerCustom),containerCustom.innerHTML=`<div id="youai-container-custom"></div>`,getPillole().then(a=>{const{content:b}=a,c=document.createElement("ul");c.classList.add("youai-ul"),b.forEach(a=>{const b=document.createElement("div");b.classList.add("youai-container-collapse");const{multimedia:d}=a,e=d?.find(a=>"video"===a.type),f=d?.find(a=>"icon"===a.type);b.innerHTML=`<button type="button" class="youai-collapsible">
                                    <div class="youai-collapsibile-icon-img">
                                      ${f?`
                                      <img class="youai-pillole-icon" src="${f.link}" />`:``}
                                      <h1 class="youai-pillole-title">
                                        ${a.title}
                                      </h1>
                                    </div>
                                    <div>
                                      <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="18"
                                        height="18"
                                        fill="#000"
                                        class="bi bi-chevron-down arrow-down"
                                        viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
                                      </svg>
                                    </div>
                                  </button>
                                  <div class="youai-content">
                                    ${a.title===a.content?"":` <p>${a.content}</p>
                                    `}  
                                    ${e?`<iframe class="youai-yt"
                                      src="${e.link}" title="YouTube video player" frameborder="0"
                                      style="${statusChat()===statusWebChat.FULLSCREEN?"height: 33rem;":""}"
                                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                      allowfullscreen>
                                      </iframe>`:``}
                                    <div>${a?.description}</div>
                                  </div>
                                  `;const g=document.createElement("li");g.appendChild(b),c.appendChild(g)}),[...c.getElementsByTagName("button")].forEach(a=>{a.addEventListener("click",function(){this.classList.toggle("active");const b=a.getElementsByClassName("arrow-down")[0].classList;b.contains("youai-rotate-arrow")?b.remove("youai-rotate-arrow"):b.add("youai-rotate-arrow");var c=this.nextElementSibling;c.style.display="block"===c.style.display?"none":"block"})}),document.getElementById("youai-container-custom").appendChild(c)}).catch(a=>{backToFirstView(),localStorage.setItem("position","close"),console.log(`Erorr: ${a}`)}))}function createCustomHeader(a){conversationContainer.insertAdjacentHTML("afterbegin",`
    <div class="rw-header custom-header">
      <h4 class="rw-title">${a}</h4>
      <div class="youai-container-close">
        <svg xmlns="http://www.w3.org/2000/svg" id="youai-close-icon" width="24" height="24" fill="#ffffff" class="bi bi-x-lg" viewBox="0 0 16 16">
          <path d="M1.293 1.293a1 1 0 0 1 1.414 0L8 6.586l5.293-5.293a1 1 0 1 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 0 1 0-1.414z"/>
        </svg>
        ${localStorage.getItem("interaction")?"":fullScreenButton()}
      </div>
    </div>
        `);let b=document.getElementById("customFullScreenButton");b&&(b=b.getElementsByTagName("img")[0],setIconToButtonFullScreen(b),b.addEventListener("click",()=>{mainContainer.classList.toggle("rw-full-screen");this.toggleClassList(document.getElementsByClassName("rw-launcher rw-hide-sm")[0],["rw-full-screen","rw-hide"])})),document.getElementById("youai-close-icon").addEventListener("click",()=>{"pillole"===localStorage.getItem("position")?(backToFirstView(),localStorage.setItem("position","open")):(removeConversationContainer(),localStorage.setItem("position","close"))})}function showOrHideChatContainer(a){const b=conversationContainer.getElementsByClassName("rw-messages-container")[0],c=conversationContainer.getElementsByTagName("form")[0];a?(b.classList.remove("youai-display-none"),c.classList.remove("youai-display-none")):(b.classList.add("youai-display-none"),c.classList.add("youai-display-none"))}function showOrHideHeaderContainer(a){const b=document.getElementsByClassName("rw-header-and-loading")[0];a?b.classList.remove("youai-display-none"):b.classList.add("youai-display-none")}function removeContainerCustom(){conversationContainer.removeChild(document.getElementsByClassName("youai-container-custom")[0])}function removeCustomHeader(){conversationContainer.removeChild(document.getElementsByClassName("custom-header")[0])}function backToFirstView(){removeContainerCustom(),removeCustomHeader(),showOrHideChatContainer(!0),showOrHideHeaderContainer(!0)}function removeConversationContainer(){let a=document.getElementsByClassName("custom-container")[0];a&&mainContainer.removeChild(a)}function autocomplete(){configuration?.section?.autocomplete?.enable&&(autocompleteElement=document.getElementById("autocomplete"),configuration?.autoFocusOnInput&&autocompleteElement.focus(),configuration?.baseUrl&&autocompleteElement.addEventListener("input",function(a){let b=a.target.value;b=b.trimStart(),clearTimeout(typingTimer),commanderResponse&&lastSearch!==b&&(closeAllLists(),localStorage.setItem("hint",!1)),typingTimer=setTimeout(()=>{5<b.length&&[...b].find(a=>" "===a)&&(lastSearch=b,localStorage.setItem("hint",!0),getHintComplete(b).then(a=>{commanderResponse=a,commanderResponse.length&&createListToComplete(this,commanderResponse)}).catch(a=>console.log(`Error: ${a}`)))},1e3)}),autocompleteElement.addEventListener("keyup",a=>{"Enter"===a.code&&(closeAllLists(),localStorage.setItem("hint",!1))}),document.getElementsByClassName("rw-messages-container")[0].addEventListener("click",a=>{localStorage.setItem("hint",!1),closeAllLists(a.target)}))}function closeAllLists(a){for(var b=document.getElementsByClassName("youai-autocomplete-items"),c=0;c<b.length;c++)a!=b[c]&&a!=autocompleteElement&&b[c].parentNode.removeChild(b[c])}function getStorage(){return"session"===storageType?sessionStorage:localStorage}function toggleClassList(a,b){[...b].map(b=>{a?.classList?.toggle(b)})}function createListToComplete(a,b){var c,d,e=a?.value;if(closeAllLists(),!e)return!1;if(c=document.createElement("div"),c.setAttribute("id",`${a.id}autocomplete-list`),c.setAttribute("class","youai-autocomplete-items"),b){for(item in 3<b.length&&(c.style.height="10rem"),c.style.bottom="4rem",b)d=document.createElement("div"),d.innerText+=b[item],d.addEventListener("click",function(){autocompleteElement.value=this.innerText,localStorage.setItem("hint",!1),closeAllLists()}),c.appendChild(d);setTimeout(()=>{conversationContainer.insertBefore(c,form)})}}const checkElement=async a=>{for(;null===document.querySelector(a);)await new Promise(a=>requestAnimationFrame(a));return document.querySelector(a)};async function getHintComplete(a){return this.optionSharedCall("recommend",JSON.stringify({text:a}),{...(project_id&&{project_id})})}async function getRecommender(){return this.optionSharedCall("nlu/recommender",null,{...(project_id&&{project_id})})}async function submitFeedback(a,b){return this.optionSharedCall("feedback",JSON.stringify({message:a,rating:b,channel:"webchat",channel_session_id:getSessionId()},{...(project_id&&{project_id})}))}function getSessionId(){const a=getStorage().getItem("chat_session");return JSON.parse(a).session_id}async function getPillole(){return this.optionSharedCall("load/file",null,{filename:configuration?.section?.pillole?.filename,...(project_id&&{project_id})})}async function uploadMedia(a){return this.optionSharedCall("upload/media",a,{conversation_id:getSessionId(),...(project_id&&{project_id})},!1)}async function optionSharedCall(a,b,c,d=!0){var e=`${configuration?.baseUrl}${a}`;if(e&&token){const a=new Headers;a.append("token",token),d&&a.append("Content-Type","application/json");var f={headers:a,method:b?"POST":"GET",...(b&&{body:b,redirect:"follow"})};JSON.stringify(c)!==JSON.stringify({})&&(e=`${e}?${new URLSearchParams({...c})}`);const g=await fetch(e,f),h=await g.json();return h.value||h.matches}return null}document.addEventListener("click",function(){const a=document.getElementById("youai-dropdown-content");a&&(a.style.display="none")},!1);function chatContainerScrollBottom(){chatContainer.scrollTop=chatContainer.scrollHeight}window.onbeforeunload=()=>{localStorage.removeItem("interaction")};const statusWebChat={OPEN:"OPEN",CLOSE:"CLOSE",FULLSCREEN:"FULLSCREEN"};